# Настройка сервера

## Настройка переменных окружения

1. **Конфигурация**

```bash
$ cp .env.example .env
```

_PROJECT_ - название основного проекта, используемого по умолчанию. \
Названием проекта является название его корневой директории расположенной в DATA_HOSTS/ (см .env)

_UID_, _GID_ - текущий пользователь, от которого происходит запуск окружения

```bash
# Определение текущего пользователя
$ id -u; id -g
```

_Если ID пользователя отлично от 1000, необходимо запустить команду инициализации_ \
_Инициализацию рекомендуется всегда запускать при установке проекта_

```bash
$ make init
```

Блок статической конфигурации обычно не требует настройки. \
Блок динамической конфигурации настраивается в случае использования в production или если есть несколько хостов

2. **Данные**

В процессе первоначального запуска

- создаются все необходимые директории с данными
- устанавливаются соответствующие права

Если используются кастомные директории, необходимо:

- установить владельцем текущего пользователя
- на директорию БД установить права 0777

3. **Доступ к сервисам извне**

Внешний доступ к определенным сервисам изначально закрыт. \
Чтобы получить доступ к нужному сервису раскомментируйте соответствующую строку конфига и обновите конфигурацию - make up

## Запуск

1. **Сборка**

```
$ make build
```

2. **Запуск**

```
$ make up
```

## Выполнение команд в окружении PHP контейнера

```bash
$ make run CMD="yarn build"
$ make run CMD="cd public; yarn install"
```

Если название проекта отличается от указанного в параметре PROJECT переменных окружения, передаем его явно

```bash
$ make run PROJECT="symfony" CMD="yarn build"
$ make run PROJECT="symfony" CMD="cd public; yarn install"
```

## Подключение к сервисам хост машина, на примере mysql-percona

В качестве хоста используем 172.17.0.1, адрес хоста в сети docker0 (по-умолчанию) для linux машин
```bash
create user 'root'@'192.168.17.%' identified by '...';
grant all on *.* to 'root'@'192.168.17.%' with grant option;
```
https://www.techrepublic.com/article/create-mysql-8-database-user-remote-access-databases/


